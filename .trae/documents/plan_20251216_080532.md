# 重写博文点赞功能方案

## 1. 问题分析

通过检查发现，**博文详情页面没有引入`post-like.js`脚本**，这是点赞功能没有反应的根本原因。虽然主题模板`post.pug`中包含了点赞按钮的HTML结构，但脚本没有被正确加载。

## 2. 解决方案

### 核心思路
1. **确保脚本被正确引入**：通过配置或模板修改，将`post-like.js`脚本引入到博文详情页面
2. **重写简洁可靠的前端代码**：确保与后端API正确交互
3. **简化设计**：减少复杂度，提高可靠性

### 具体实现步骤

#### 步骤1：配置主题注入自定义脚本

在`_config.butterfly.yml`中添加注入配置，将`post-like.js`脚本引入到页面底部。

#### 步骤2：重写前端`post-like.js`代码

创建一个简洁可靠的`post-like.js`文件，包含以下功能：

- **简化的API调用**：直接使用按钮的`data-post-id`属性
- **清晰的状态管理**：加载状态、成功状态、失败状态
- **防重复点击**：点击后立即禁用按钮
- **匿名用户支持**：自动生成唯一ID

#### 步骤3：确保后端API正常

验证后端API已经正常工作，之前的测试已经证明：
- `/api/posts/:postId/like`端点能够正确处理点赞请求
- 点赞数会被持久化到数据库
- 支持匿名和登录用户

#### 步骤4：测试验证

- 运行`hexo g`重新生成静态文件
- 访问博文详情页面，打开浏览器开发者工具
- 检查`post-like.js`是否被正确引入
- 测试点赞功能是否正常工作

## 3. 前端代码设计

### 核心功能

```javascript
// 初始化点赞功能
document.addEventListener('DOMContentLoaded', () => {
  const likeButtons = document.querySelectorAll('.post-like-btn');
  likeButtons.forEach(button => {
    // 获取postId
    const postId = button.dataset.postId;
    // 初始化点赞状态
    initializeLikeButton(button, postId);
    // 添加点击事件
    button.addEventListener('click', () => likePost(button, postId));
  });
});

// 初始化点赞按钮状态
async function initializeLikeButton(button, postId) {
  // 获取当前点赞数和状态
  // 更新按钮显示
}

// 处理点赞请求
async function likePost(button, postId) {
  // 禁用按钮，防止重复点击
  button.disabled = true;
  // 显示加载状态
  // 发送点赞请求
  // 更新点赞数和按钮状态
  // 重新启用按钮
}
```

## 4. 预期效果

- ✅ 博文详情页面正确引入`post-like.js`脚本
- ✅ 点赞按钮能够正常点击
- ✅ 点赞数能够实时更新
- ✅ 支持匿名和登录用户
- ✅ 防止重复点赞
- ✅ 点赞数持久化到数据库

通过这个方案，我们可以确保博文点赞功能正常工作，提供良好的用户体验。